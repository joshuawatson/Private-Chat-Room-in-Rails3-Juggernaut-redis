<h1 class='current'>Welcome to my Chatting application :)</h1>
<% if user_signed_in? %>
  <div id='sidebar'>
  	<h3>Online users</h3>
    <ul id='channels'>
    	<% @logged_in_users.each do |user|%>
			  <li class='item current' id='user_<%=user.id%>'><%=user.channel_name %></li>
			<% end %>
    </ul>
  </div>
<% end %>
<input type="button" name="toggle" value="toggle" />
<div id="chat_div">
</div>
<hr />
<div id="log">
</div>
<script type="text/javascript">
      $(document).ready(function(){
          var box = null;
          $("input[type='button']").click(function(event, ui) {
              if(box) {
                  box.chatbox("option", "boxManager").toggleBox();
              }
              else {
                  box = $("#chat_div").chatbox({id:"chat_div", 
                                                user:{key : "value"},
                                                title : "test chat",
                                                messageSent : function(id, user, msg) {
                                                    $("#log").append(id + " said: " + msg + "<br/>");
                                                    $("#chat_div").chatbox("option", "boxManager").addMsg(id, msg);
                                                }});
              }
          });
      });
 </script>

<script type='text/javascript'>
	$(document).ready(function(){
		$("li").click(function(){
			$.post('/channels', {sender_id: '<%=current_user.id%>', receiver_id: $(this).attr('id').replace(/user_/, '')}, function(data) {
         //window.open('/channels/' + data, 'channel', 'width=600,height=300, scrollbars=yes')  
      }, "html").success(function(data){ 
			           window.open('/channels/' + data, 'channel', 'width=400,height=200, scrollbars=yes');
						});
		})
	});
</script>